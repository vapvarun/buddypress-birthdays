($=>{var BPBirthdays={settings:{tooltipDelay:300,debounceDelay:250,fadeSpeed:200,animationDuration:300},cache:{},init:function(){this.cacheElements(),this.initTooltips(),this.initAccessibility(),this.bindEvents(),this.optimizeLayout(),this.initSpecialEffects()},cacheElements:function(){this.cache.$document=$(document),this.cache.$window=$(window),this.cache.$body=$("body"),this.cache.$birthdayWidgets=$(".widget_bp_birthdays"),this.cache.$birthdayLists=$(".bp-birthday-users-list"),this.cache.$sendWishesButtons=$(".bp-send-wishes"),this.cache.$todayBirthdays=$(".today-birthday")},bindEvents:function(){this.cache.$document.on("click.bpBirthdays",".bp-send-wishes",this.handleWishesClick.bind(this)),this.cache.$document.on("widget-updated.bpBirthdays",this.handleWidgetUpdate.bind(this)),this.cache.$window.on("resize.bpBirthdays",this.debounce(this.handleResize.bind(this),this.settings.debounceDelay)),this.cache.$document.on("visibilitychange.bpBirthdays",this.handleVisibilityChange.bind(this)),this.cache.$window.on("scroll.bpBirthdays",this.debounce(this.handleScroll.bind(this),100))},handleWishesClick:function(e){let $button=$(e.currentTarget);var href=$button.attr("href");href&&"#"!==href?$button.hasClass("loading")?e.preventDefault():($button.addClass("loading").attr("aria-disabled","true"),this.trackWishEvent($button),setTimeout(()=>{$button.removeClass("loading").removeAttr("aria-disabled")},1e3)):(e.preventDefault(),href="undefined"!=typeof bbBirthdays&&bbBirthdays.strings&&bbBirthdays.strings.wishes_error?bbBirthdays.strings.wishes_error:"Unable to send wishes at this time.",this.showMessage(href,"error"))},initTooltips:function(){0!==this.cache.$sendWishesButtons.length&&this.cache.$sendWishesButtons.each((index,element)=>{let $button=$(element),$tooltip=$button.find(".tooltip_wishes");if(0!==$tooltip.length){let tooltipTimer;$button.on("mouseenter.tooltip",()=>{clearTimeout(tooltipTimer),tooltipTimer=setTimeout(()=>{$tooltip.addClass("visible"),this.positionTooltip($button,$tooltip)},this.settings.tooltipDelay)}).on("mouseleave.tooltip",()=>{clearTimeout(tooltipTimer),$tooltip.removeClass("visible")}).on("focus.tooltip",()=>{$tooltip.addClass("visible"),this.positionTooltip($button,$tooltip)}).on("blur.tooltip",()=>{$tooltip.removeClass("visible")})}})},positionTooltip:function($button,$tooltip){var $button=$button.offset(),tooltipWidth=$tooltip.outerWidth(),viewportWidth=$(window).width();$button.left+tooltipWidth>viewportWidth?$tooltip.addClass("tooltip-right"):$tooltip.removeClass("tooltip-right")},initAccessibility:function(){this.cache.$sendWishesButtons.each(function(){var $button=$(this);$button.attr("aria-label")||$button.attr("aria-label","Send birthday wishes"),$button.attr("role","button")}),this.cache.$birthdayLists.attr("role","list"),this.cache.$birthdayLists.find(".bp-birthday-item").attr("role","listitem"),this.cache.$birthdayWidgets.attr("role","complementary").attr("aria-label","Birthday notifications")},initSpecialEffects:function(){0<this.cache.$todayBirthdays.length&&(this.initBirthdayAnimations(),this.initConfettiEffect()),this.initScrollAnimations()},initBirthdayAnimations:function(){this.cache.$todayBirthdays.each(function(index){let $item=$(this);setTimeout(()=>{$item.addClass("birthday-celebrate")},200*index)})},initConfettiEffect:function(){"undefined"!=typeof bbBirthdays&&bbBirthdays.settings&&bbBirthdays.settings.confetti_enabled&&"function"==typeof this.createConfetti&&this.cache.$todayBirthdays.each((index,element)=>{setTimeout(()=>{this.createConfetti($(element))},500*index)})},createConfetti:function($target,options={}){try{if(!window.matchMedia||!window.matchMedia("(prefers-reduced-motion: reduce)").matches){var colors=[{front:"#ff6b9d",back:"#c44569"},{front:"#4facfe",back:"#00f2fe"},{front:"#43e97b",back:"#38f9d7"},{front:"#f093fb",back:"#f5576c"},{front:"#ffd700",back:"#ffed4e"},{front:"#fa709a",back:"#fee140"},{front:"#30cfd0",back:"#330867"},{front:"#a8edea",back:"#fed6e3"},{front:"#ff9a56",back:"#ff6a88"},{front:"#667eea",back:"#764ba2"}],shapes=["circle","square","ribbon","triangle"],count=options.count||50,rect=$target[0].getBoundingClientRect(),centerX=rect.left+rect.width/2,centerY=rect.top+rect.height/2;let container=document.createElement("div");container.className="bb-confetti-container",container.setAttribute("aria-hidden","true"),container.style.perspective="1000px",document.body.appendChild(container);for(let i=0;i<count;i++){var particle=document.createElement("div"),shape=(particle.className="bb-confetti bb-confetti-particle",shapes[Math.floor(Math.random()*shapes.length)]),colorPair=colors[Math.floor(Math.random()*colors.length)],size="ribbon"===shape?{w:4+4*Math.random(),h:12+8*Math.random()}:{w:8+6*Math.random(),h:8+6*Math.random()},angle=(140*Math.random()-70)*(Math.PI/180),velocity=150+200*Math.random(),spread=Math.cos(angle)*velocity,lift=-Math.abs(Math.sin(angle)*velocity)-50,gravity=800+400*Math.random(),drag=.98-.03*Math.random(),rotationX=720*(Math.random()-.5),rotationY=720*(Math.random()-.5),rotationZ=1080*(Math.random()-.5),wobble=120*(Math.random()-.5),delay=.15*Math.random(),duration=+Math.random()+2.5;particle.style.cssText=`
                        position: absolute;
                        left: ${centerX}px;
                        top: ${centerY+window.scrollY}px;
                        width: ${size.w}px;
                        height: ${size.h}px;
                        background: linear-gradient(135deg, ${colorPair.front} 0%, ${colorPair.back} 100%);
                        pointer-events: none;
                        will-change: transform, opacity;
                        transform-style: preserve-3d;
                        z-index: 9999;
                        box-shadow: 0 0 4px rgba(0,0,0,0.1);
                    `,"circle"===shape?particle.style.borderRadius="50%":"ribbon"===shape?particle.style.borderRadius="2px":"triangle"===shape?(particle.style.background="transparent",particle.style.borderLeft=size.w/2+"px solid transparent",particle.style.borderRight=size.w/2+"px solid transparent",particle.style.borderBottom=size.h+"px solid "+colorPair.front,particle.style.width="0",particle.style.height="0"):particle.style.borderRadius="1px",container.appendChild(particle),((p,spreadX,liftY,grav,dr,rotX,rotY,rotZ,wob,dur)=>{setTimeout(function(){var time=1e3*dur,frames=[];let posX=0,posY=0,velX=spreadX,velY=liftY;for(let step=0;step<=60;step++){var t=step/60,dt=dur/60,dt=(velY+=grav*dt,velX*=dr,velY*=dr,posX+=velX*dt,posY+=velY*dt,Math.sin(t*Math.PI*4)*wob*t),opacity=Math.max(0,1-Math.pow(t,2));frames.push({transform:`
                                        translate3d(${posX+dt}px, ${posY}px, 0)
                                        rotateX(${rotX*t}deg)
                                        rotateY(${rotY*t}deg)
                                        rotateZ(${rotZ*t}deg)
                                    `,opacity:opacity,offset:t})}p.animate(frames,{duration:time,easing:"linear",fill:"forwards"}).onfinish=function(){p&&p.parentNode&&p.parentNode.removeChild(p)}},1e3*delay)})(particle,spread,lift,gravity,drag,rotationX,rotationY,rotationZ,wobble,duration)}setTimeout(function(){container&&container.parentNode&&container.parentNode.removeChild(container)},5e3)}}catch(e){}},initScrollAnimations:function(){if("IntersectionObserver"in window){let observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{entry.isIntersecting&&$(entry.target).addClass("animate-in")})},{threshold:.1,rootMargin:"50px"});this.cache.$birthdayLists.find(".bp-birthday-item").each(function(){observer.observe(this)})}},handleWidgetUpdate:function(e,widget){$(widget).hasClass("widget_bp_birthdays")&&setTimeout(()=>{this.cacheElements(),this.initTooltips(),this.initAccessibility(),this.initSpecialEffects()},100)},handleResize:function(){this.optimizeLayout(),this.repositionTooltips()},handleVisibilityChange:function(){document.hidden?this.cache.$birthdayWidgets.addClass("paused-animations"):this.cache.$birthdayWidgets.removeClass("paused-animations")},handleScroll:function(){this.optimizeVisibleElements()},optimizeLayout:function(){var isMobile=window.innerWidth<=768,isTablet=window.innerWidth<=1024&&768<window.innerWidth;this.cache.$birthdayLists.toggleClass("mobile-layout",isMobile).toggleClass("tablet-layout",isTablet),isMobile?this.cache.$birthdayLists.find(".avatar, .avatar-link").addClass("small-avatar"):this.cache.$birthdayLists.find(".avatar, .avatar-link").removeClass("small-avatar")},optimizeVisibleElements:function(){let viewportTop=this.cache.$window.scrollTop(),viewportBottom=viewportTop+this.cache.$window.height();this.cache.$birthdayWidgets.each(function(){var $widget=$(this),elementTop=$widget.offset().top,elementTop=elementTop+$widget.height()>viewportTop&&elementTop<viewportBottom;$widget.toggleClass("in-viewport",elementTop)})},repositionTooltips:function(){this.cache.$sendWishesButtons.find(".tooltip_wishes.visible").each((index,element)=>{var element=$(element),$button=element.closest(".bp-send-wishes");this.positionTooltip($button,element)})},trackWishEvent:function($button){var userName=$button.closest(".bp-birthday-item").find(".bp-birthday-name a").text()||"Unknown";"undefined"!=typeof gtag&&gtag("event","birthday_wish_sent",{event_category:"engagement",event_label:"buddypress_birthdays",custom_parameters:{user_name:userName,widget_location:this.getWidgetLocation($button)}}),"undefined"!=typeof ga&&ga("send","event","Birthday Wishes","Send",userName),"function"==typeof window.customBirthdayTracking&&window.customBirthdayTracking("wish_sent",{user:userName,timestamp:(new Date).toISOString()})},getWidgetLocation:function($button){$button=$button.closest(".widget_bp_birthdays");return $button.closest(".sidebar").length?"sidebar":$button.closest(".footer").length?"footer":$button.closest(".header").length?"header":"content"},showMessage:function(message,type="info"){type=$(`<div class="${"bp-birthday-message bp-birthday-"+type}" role="alert">${message}</div>`);let $container=$(".widget_bp_birthdays").first();0===$container.length&&($container=$("body")),type.prependTo($container).hide().fadeIn(this.settings.fadeSpeed).delay(3e3).fadeOut(this.settings.fadeSpeed,function(){$(this).remove()})},createNotification:function(title,message,options={}){if("Notification"in window&&"granted"===Notification.permission){let notification=new Notification(title,{body:message,icon:options.icon||'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üéÇ</text></svg>',tag:"birthday-notification",requireInteraction:!1,...options});return setTimeout(()=>notification.close(),5e3),notification}},requestNotificationPermission:function(){"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission().then(permission=>{"granted"===permission&&this.showMessage("Birthday notifications enabled!","success")})},debounce:function(func,wait){let timeout;return function(...args){clearTimeout(timeout),timeout=setTimeout(()=>{clearTimeout(timeout),func.apply(this,args)},wait)}},throttle:function(func,limit){let inThrottle;return function(){var args=arguments;inThrottle||(func.apply(this,args),inThrottle=!0,setTimeout(()=>inThrottle=!1,limit))}},preloadImages:function(){[].forEach(src=>{(new Image).src=src})},destroy:function(){this.cache.$document.off(".bpBirthdays"),this.cache.$window.off(".bpBirthdays"),this.cache.$sendWishesButtons.off(".tooltip"),this.tooltipTimer&&clearTimeout(this.tooltipTimer),this.cache.$birthdayLists.removeClass("mobile-layout tablet-layout"),this.cache.$birthdayWidgets.removeClass("paused-animations in-viewport")},refresh:function(){this.destroy(),this.init()},updateSettings:function(newSettings){this.settings=$.extend(this.settings,newSettings)},getTodaysBirthdays:function(){return this.cache.$todayBirthdays.length},getUpcomingBirthdays:function(){return this.cache.$birthdayLists.find(".bp-birthday-item").length}},BirthdayUtils=($(document).ready(function(){BPBirthdays.init(),BPBirthdays.preloadImages(),0<BPBirthdays.getTodaysBirthdays()&&setTimeout(()=>{BPBirthdays.requestNotificationPermission()},2e3)}),$(window).on("beforeunload",function(){BPBirthdays.destroy()}),window.BPBirthdays=BPBirthdays,{formatDate:function(dateString,format="F j"){var date=new Date(dateString),months=["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];switch(format){case"F j":return months[date.getMonth()]+" "+date.getDate();case"M j":return shortMonths[date.getMonth()]+" "+date.getDate();case"j F":return date.getDate()+" "+months[date.getMonth()];case"j M":return date.getDate()+" "+shortMonths[date.getMonth()];default:return date.toLocaleDateString()}},calculateAge:function(birthDate){var today=new Date,birthDate=new Date(birthDate);let age=today.getFullYear()-birthDate.getFullYear();var monthDiff=today.getMonth()-birthDate.getMonth();return(monthDiff<0||0==monthDiff&&today.getDate()<birthDate.getDate())&&age--,age},isToday:function(dateString){var today=new Date,dateString=new Date(dateString);return today.getDate()===dateString.getDate()&&today.getMonth()===dateString.getMonth()},isTomorrow:function(dateString){var tomorrow=new Date,dateString=(tomorrow.setDate(tomorrow.getDate()+1),new Date(dateString));return tomorrow.getDate()===dateString.getDate()&&tomorrow.getMonth()===dateString.getMonth()},getDaysUntilBirthday:function(birthDate){var today=new Date,birthDate=new Date(birthDate),currentYear=today.getFullYear(),birthDate=new Date(currentYear,birthDate.getMonth(),birthDate.getDate()),currentYear=(birthDate<today&&birthDate.setFullYear(currentYear+1),birthDate-today);return Math.ceil(currentYear/864e5)},getUpcomingBirthdays:function(birthdays,limit=5){let today=new Date,currentYear=today.getFullYear();return birthdays.map(birthday=>{var birthDate=new Date(birthday.date),birthDate=new Date(currentYear,birthDate.getMonth(),birthDate.getDate());return birthDate<today&&birthDate.setFullYear(currentYear+1),{...birthday,nextBirthday:birthDate,daysUntil:Math.ceil((birthDate-today)/864e5),isToday:this.isToday(birthday.date),isTomorrow:this.isTomorrow(birthday.date)}}).sort((a,b)=>a.nextBirthday-b.nextBirthday).slice(0,limit)},getBirthdayGreeting:function(name,age){age=[`Happy Birthday, ${name}! üéâ`,`Wishing you a wonderful ${age}th birthday, ${name}! üéÇ`,`Hope your special day is amazing, ${name}! üéà`,`Many happy returns, ${name}! üéÅ`,`Have a fantastic birthday, ${name}! ‚ú®`];return age[Math.floor(Math.random()*age.length)]},generateBirthdayMessage:function(name,age){name=[`Hi ${name}! Wishing you a very happy ${age}th birthday! Hope your day is filled with joy and celebration! üéâ`,`Happy Birthday ${name}! May this new year of life bring you happiness, health, and all your heart desires! üéÇ`,`Dear ${name}, Happy ${age}th Birthday! Hope you have a wonderful day surrounded by family and friends! üéà`,name+`, wishing you the happiest of birthdays! May ${age} be your best year yet! üéÅ`];return name[Math.floor(Math.random()*name.length)]}});window.BirthdayUtils=BirthdayUtils,$("<style>").prop("type","text/css").html(`
            .bp-birthday-message {
                padding: 12px 16px;
                margin: 10px 0;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
            }
            
            .bp-birthday-info {
                background: #dbeafe;
                color: #1e40af;
                border-left: 4px solid #3b82f6;
            }
            
            .bp-birthday-success {
                background: #dcfce7;
                color: #166534;
                border-left: 4px solid #22c55e;
            }
            
            .bp-birthday-error {
                background: #fee2e2;
                color: #dc2626;
                border-left: 4px solid #ef4444;
            }
            
            .birthday-celebrate {
                animation: celebrate 0.6s ease-out;
            }
            
            @keyframes celebrate {
                0% { transform: scale(1); }
                50% { transform: scale(1.02); }
                100% { transform: scale(1); }
            }
            
            .animate-in {
                animation: slideInUp 0.4s ease-out;
            }
            
            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .small-avatar {
                width: 40px !important;
                height: 40px !important;
            }
            
            .paused-animations * {
                animation-play-state: paused !important;
            }
            
            .tooltip-right {
                left: auto !important;
                right: 0 !important;
                transform: translateX(0) !important;
            }
        `).appendTo("head")})(jQuery),"undefined"!=typeof performance&&console.time&&(console.time("BP Birthdays Init"),jQuery(document).ready(function(){console.timeEnd("BP Birthdays Init"),window.BPBirthdays&&(console.log("BP Birthdays Widget loaded successfully"),console.log("Today's birthdays:",window.BPBirthdays.getTodaysBirthdays()),console.log("Upcoming birthdays:",window.BPBirthdays.getUpcomingBirthdays()))}));